<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Owner Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Optional: Add some spacing for the new controls for better readability */
        .settings-form-container .form-group {
            margin-bottom: 20px;
        }
        .settings-form-container hr {
            border: 0;
            height: 1px;
            background-color: #e0e0e0;
            margin: 25px 0;
        }
        .settings-input, #reopen-time {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
            box-sizing: border-box; /* Ensures padding doesn't affect width */
        }
        .green-btn {
            background-color: #4CAF50 !important; /* Green for Open */
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- ===== SIDEBAR ===== -->
        <aside class="sidebar">
            <div class="sidebar-header"><h3>Burger POS</h3></div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-link active" data-view="dashboard-view"><i class="fas fa-chart-pie"></i><span>Dashboard</span></a>
                <a href="#" class="nav-link" data-view="orders-view"><i class="fas fa-receipt"></i><span>Orders</span></a>
                <a href="#" class="nav-link" data-view="shifts-view"><i class="fas fa-cash-register"></i><span>Shifts</span></a>
                <a href="#" class="nav-link" data-view="reports-view"><i class="fas fa-chart-bar"></i><span>Reports</span></a>
                <a href="#" class="nav-link" data-view="inventory-view"><i class="fas fa-boxes-stacked"></i><span>Inventory</span></a>
                <a href="#" class="nav-link" data-view="menu-view"><i class="fas fa-hamburger"></i><span>Menu</span></a>
                <a href="#" class="nav-link" data-view="customers-view"><i class="fas fa-users"></i><span>Customers</span></a>
                <a href="#" class="nav-link active" data-view="settings-view"><i class="fas fa-cog"></i><span>Settings</span></a>
                <a href="#" id="logout-btn" class="nav-link" style="margin-top: auto;"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a>
            </nav>
        </aside>

        <!-- ===== MAIN CONTENT ===== -->
        <main class="main-content">
            <!-- VIEW 1: Dashboard -->
            <section id="dashboard-view" class="main-view">
                <header class="main-header">
                    <h1>Dashboard</h1>
                    <div class="header-actions"><span>Current Week</span><button class="add-item-btn">+ Add Item</button></div>
                </header>
                <section class="stats-grid">
                    <div class="stat-card"><div class="stat-card-icon blue"><i class="fas fa-receipt"></i></div><div class="stat-card-info"><p class="stat-card-title">Transaction Count</p><h2 id="transaction-count-display" class="stat-card-value">0</h2></div></div>
                    <div class="stat-card"><div class="stat-card-icon green"><i class="fas fa-dollar-sign"></i></div><div class="stat-card-info"><p class="stat-card-title">Total Revenue</p><h2 id="total-revenue-display" class="stat-card-value">RM 0.00</h2></div></div>
                    <div class="stat-card"><div class="stat-card-icon teal"><i class="fas fa-chart-line"></i></div><div class="stat-card-info"><p class="stat-card-title">Average Transaction Value</p><h2 id="avg-transaction-display" class="stat-card-value">RM 0.00</h2></div></div>
                    <div class="stat-card"><div class="stat-card-icon purple"><i class="fas fa-trophy"></i></div><div class="stat-card-info"><p class="stat-card-title">Today's Best Seller</p><h2 id="best-seller-display" class="stat-card-value">N/A</h2></div></div>
                </section>
                <section class="data-grid">
                    <div class="data-card chart-container"><header class="data-card-header"><h3>Sales Trends</h3></header><div class="data-card-body"><canvas id="sales-trends-chart"></canvas></div></div>
                    <div class="data-card items-container"><header class="data-card-header"><h3>Accepted Items</h3></header><div class="data-card-body"><table class="items-table"><thead><tr><th>Product Name</th><th>Sold Today</th><th>Status</th></tr></thead><tbody id="accepted-items-tbody"></tbody></table></div></div>
                </section>
            </section>

            <!-- VIEW 2: All Orders -->
            <section id="orders-view" class="main-view">
                <header class="main-header"><h1>All Orders</h1></header>
                <div class="data-card">
                    <table class="items-table all-orders-table">
                        <thead>
                            <tr>
                                <th>Order #</th>
                                <th>Customer</th>
                                <th>Total (RM)</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="all-orders-tbody"></tbody>
                    </table>
                </div>
            </section>

            <!-- VIEW: Shift Management -->
            <section id="shifts-view" class="main-view">
                <header class="main-header">
                    <h1>Shift Management</h1>
                    <button id="start-shift-btn" class="add-item-btn">+ Start New Shift</button>
                </header>
                <div class="data-card">
                     <header class="data-card-header"><h3>Active Shift</h3></header>
                     <div id="active-shift-section" class="active-shift-container" style="display: none;">
                        <!-- Active shift details will be populated by JS -->
                     </div>
                     <div id="no-active-shift-message" class="empty-state">
                        <p>No active shift. Click "Start New Shift" to begin.</p>
                     </div>
                </div>
                <div class="data-card">
                    <header class="data-card-header"><h3>Shift History</h3></header>
                    <table class="items-table all-orders-table">
                        <thead>
                            <tr>
                                <th>Start Time</th>
                                <th>End Time</th>
                                <th>Expected Cash (RM)</th>
                                <th>Counted Cash (RM)</th>
                                <th>Difference (RM)</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="shift-history-tbody">
                            <!-- Shift history will be populated by JS -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- VIEW 3: Sales Report -->
            <section id="reports-view" class="main-view">
                <header class="main-header">
                    <h1>Sales Reports</h1>
                    <div class="header-actions filter-buttons"><button class="filter-btn active" data-period="today">Today</button><button class="filter-btn" data-period="week">This Week</button><button class="filter-btn" data-period="month">This Month</button><button class="filter-btn" data-period="all">All Time</button></div>
                </header>
                <section class="stats-grid"><div class="stat-card"><div class="stat-card-icon green"><i class="fas fa-dollar-sign"></i></div><div class="stat-card-info"><p class="stat-card-title">Total Revenue</p><h2 id="report-total-revenue" class="stat-card-value">RM 0.00</h2></div></div><div class="stat-card"><div class="stat-card-icon blue"><i class="fas fa-receipt"></i></div><div class="stat-card-info"><p class="stat-card-title">Total Orders</p><h2 id="report-total-orders" class="stat-card-value">0</h2></div></div><div class="stat-card"><div class="stat-card-icon orange"><i class="fas fa-box-open"></i></div><div class="stat-card-info"><p class="stat-card-title">Total Items Sold</p><h2 id="report-total-items" class="stat-card-value">0</h2></div></div><div class="stat-card profit-placeholder"><div class="stat-card-icon purple"><i class="fas fa-piggy-bank"></i></div><div class="stat-card-info"><p class="stat-card-title">Gross Profit</p><h2 id="report-gross-profit" class="stat-card-value">N/A</h2></div></div></section>
                <div class="data-card"><header class="data-card-header"><h3>Financial Goals</h3></header><div class="break-even-container"><h4 >Monthly Break-Even Analysis</h4><div class="break-even-metrics"><div class="break-even-metric"><p>Target Revenue:</p><span id="break-even-revenue">RM 0.00</span></div><div class="break-even-metric"><p>Items to Sell:</p><span id="break-even-items">0</span></div></div><div class="progress-bar-container"><p>Progress This Month</p><div class="progress-bar-background"><div class="progress-bar-fill" id="break-even-progress" style="width: 0%;"></div></div><span id="break-even-progress-text">0%</span></div></div></div>
                <div class="data-card"><header class="data-card-header"><h3>Product Sales Analysis</h3></header><table class="items-table all-orders-table"><thead><tr><th>Product Name</th><th>Quantity Sold</th><th>Total Revenue (RM)</th></tr></thead><tbody id="product-sales-tbody"></tbody></table></div>
            </section>

            <!-- VIEW 4: Inventory Management -->
            <section id="inventory-view" class="main-view">
                <header class="main-header"><h1>Inventory Management</h1><button id="add-ingredient-btn" class="add-item-btn">+ Add New Ingredient</button></header>
                <div class="data-card"><table class="items-table all-orders-table"><thead><tr><th>Ingredient Name</th><th>Current Stock</th><th>Unit</th><th>Low Stock Alert</th><th>Cost per Unit (RM)</th><th>Status</th><th>Actions</th></tr></thead><tbody id="inventory-tbody"></tbody></table></div>
            </section>
            
            <!-- VIEW 5: Menu Management -->
            <section id="menu-view" class="main-view">
                <header class="main-header"><h1>Menu & Profitability Analysis</h1></header>
                <div class="data-card"><table class="items-table all-orders-table"><thead><tr><th>Product Name</th><th>Price (RM)</th><th>Calculated Cost (RM)</th><th>Profit (RM)</th><th>Margin (%)</th><th>Actions</th></tr></thead><tbody id="menu-tbody"></tbody></table></div>
            </section>

            <!-- VIEW 6: Customers -->
            <section id="customers-view" class="main-view">
                <header class="main-header"><h1>Customers</h1></header>
                <div id="customer-list-container" class="customer-grid"></div>
            </section>

            <!-- VIEW 7: Settings -->
            <section id="settings-view" class="main-view active">
                <header class="main-header"><h1>Settings</h1></header>
                <div class="data-card">
                    <header class="data-card-header"><h3>Store Controls</h3></header>
                    <div class="settings-form-container">
                        
                        <!-- =========== NEW STORE CONTROLS START =========== -->
                        <!-- This section replaces the old toggle switch -->

                        <!-- 1. Current Status Display -->
                        <div class="form-group">
                            <label>Current Online Ordering Status</label>
                            <p class="description">This is the live status that your customers see.</p>
                            <strong id="current-status-text" class="store-status-label" style="font-size: 1.2em; padding-top: 5px; display: inline-block;">LOADING...</strong>
                        </div>

                        <hr>

                        <!-- 2. Close with automatic reopening time -->
                        <div class="form-group">
                            <label for="reopen-time">Option 1: Close and set automatic reopening time</label>
                            <p class="description">Choose this if you have a fixed reopening time. The store will automatically open for orders at the selected date and time.</p>
                            <input type="datetime-local" id="reopen-time" class="settings-input">
                            <button type="button" id="set-reopen-btn" class="add-item-btn" style="margin-top: 10px;">Close With Timer</button>
                        </div>

                        <hr>

                        <!-- 3. Close for prayer/short break -->
                        <div class="form-group">
                            <label for="close-for-break-btn">Option 2: Close for a short break (e.g., prayer)</label>
                            <p class="description">This displays a "will open later" message. You must manually reopen the store using Option 4 when you are ready.</p>
                            <button type="button" id="close-for-break-btn" class="add-item-btn">Close Temporarily</button>
                        </div>

                        <hr>

                        <!-- 4. Manually Open Store -->
                        <div class="form-group">
                            <label for="open-store-btn">Option 3: Manually Open Store</label>
                            <p class="description">Use this to immediately open the store for online orders. This will override any timed closures.</p>
                            <button type="button" id="open-store-btn" class="add-item-btn green-btn">Open Store Now</button>
                        </div>
                        
                        <!-- ============ NEW STORE CONTROLS END ============ -->

                    </div>
                </div>
                <div class="data-card">
                    <header class="data-card-header"><h3>Business Settings</h3></header>
                    <form id="settings-form" class="settings-form-container"><div class="form-group"><label for="fixed-costs-input">Monthly Fixed Costs (RM)</label><p class="description">Enter all your fixed monthly costs like rent, salaries, utilities, etc. This is used to calculate your break-even point.</p><input type="number" step="0.01" id="fixed-costs-input" placeholder="e.g., 2500.00" required></div><button type="submit" class="add-item-btn">Save Settings</button></form>
                </div>
            </section>
        </main>
    </div>

    <!-- All Modals -->
    <div id="ingredient-modal" class="modal-overlay"><div class="modal-content"><span id="close-ingredient-modal" class="close-btn">&times;</span><h3 id="ingredient-modal-title">Add New Ingredient</h3><form id="ingredient-form"><input type="hidden" id="ingredient-key"><div class="form-group"><label for="ingredient-name">Ingredient Name</label><input type="text" id="ingredient-name" placeholder="e.g., Patty Daging Ramly" required></div><div class="form-group"><label for="ingredient-stock">Current Stock</label><input type="number" step="any" id="ingredient-stock" placeholder="e.g., 50" required></div><div class="form-group"><label for="ingredient-unit">Unit</label><input type="text" id="ingredient-unit" placeholder="e.g., pcs, g, kg, packet" required></div><div class="form-group"><label for="ingredient-cost">Cost per Unit (RM)</label><input type="number" step="0.01" id="ingredient-cost" placeholder="e.g., 1.80" required></div><div class="form-group"><label for="ingredient-threshold">Low Stock Alert Level</label><input type="number" step="any" id="ingredient-threshold" placeholder="e.g., 10" required></div><button type="submit" class="add-item-btn">Save Ingredient</button></form></div></div>
    <div id="add-stock-modal" class="modal-overlay"><div class="modal-content"><span id="close-add-stock-modal" class="close-btn">&times;</span><h3 id="add-stock-modal-title">Add Stock for...</h3><form id="add-stock-form"><input type="hidden" id="add-stock-key"><div class="form-group"><label for="stock-to-add">Quantity to Add</label><input type="number" step="any" id="stock-to-add" required></div><button type="submit" class="add-item-btn">Update Stock</button></form></div></div>
    <div id="recipe-modal" class="modal-overlay"><div class="modal-content"><span id="close-recipe-modal" class="close-btn">&times;</span><h3 id="recipe-modal-title">Edit Recipe for...</h3><form id="recipe-form"><input type="hidden" id="recipe-product-key"><input type="hidden" id="recipe-variant-key"><div class="form-group"><label for="recipe-price">Selling Price (RM)</label><input type="number" step="0.01" id="recipe-price" required></div><hr><h4>Ingredients</h4><div id="recipe-ingredient-list" class="recipe-grid"></div><button type="submit" class="add-item-btn">Save Recipe & Price</button></form></div></div>
    <div id="payment-modal" class="modal-overlay"><div class="modal-content"><span id="close-payment-modal" class="close-btn">&times;</span><h3 id="payment-modal-title">Process Payment for Order #000</h3><p class="payment-total">Total Amount: <strong id="payment-modal-total">RM 0.00</strong></p><div class="payment-options"><button id="pay-by-cash-btn" class="payment-btn cash"><i class="fas fa-money-bill-wave"></i><span>Pay with Cash</span></button><button id="pay-by-qr-btn" class="payment-btn qr"><i class="fas fa-qrcode"></i><span>Pay with QR / Online</span></button></div></div></div>

    <!-- NEW MODALS START: Shift Management -->
    <div id="start-shift-modal" class="modal-overlay">
        <div class="modal-content">
            <span id="close-start-shift-modal" class="close-btn">&times;</span>
            <h3>Start New Shift</h3>
            <form id="start-shift-form">
                <div class="form-group">
                    <label for="starting-float-input">Starting Cash (Float) in RM</label>
                    <p class="description">Enter the total amount of cash in your drawer at the beginning of this shift.</p>
                    <input type="number" step="0.01" id="starting-float-input" placeholder="e.g., 50.00" required>
                </div>
                <button type="submit" class="add-item-btn">Start Shift</button>
            </form>
        </div>
    </div>

    <div id="close-shift-modal" class="modal-overlay">
        <div class="modal-content">
            <span id="close-close-shift-modal" class="close-btn">&times;</span>
            <h3>Close Shift & Count Cash</h3>
            <form id="close-shift-form">
                <div id="close-shift-summary" class="shift-summary-box">
                    <!-- Summary details will be added by JS -->
                </div>
                <div class="form-group">
                    <label for="final-cash-input">Final Counted Cash in RM</label>
                    <p class="description">Count all physical cash in your drawer and enter the final total here.</p>
                    <input type="number" step="0.01" id="final-cash-input" placeholder="e.g., 354.50" required>
                </div>
                <button type="submit" class="add-item-btn danger">End Shift & Generate Report</button>
            </form>
        </div>
    </div>
    <!-- Add this to owner_dashboard.html -->
<div class="stat-card">
    <div class="stat-card-info">
        <p class="stat-card-title">Set Today's Sales Target (RM)</p>
        <input type="number" id="sales-target-input" placeholder="e.g., 500" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc;">
        <button id="save-target-btn" style="width: 100%; padding: 8px; margin-top: 10px; background-color: #5E35B1; color: white; border: none; border-radius: 4px; cursor: pointer;">Save Target</button>
    </div>
</div>
    <!-- NEW MODALS END: Shift Management -->

    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <script src="owner_dashboard.js"></script>
</body>
</html>